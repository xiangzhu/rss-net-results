---
title: "A quick assessment of MusDev lists on human complex traits"
author: "Xiang Zhu"
date: "2018-07-19"
output: workflowr::wflow_html
---

```{r, echo=FALSE}
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(ggpubr))
```

## MusDev lists

Below is an example of MusDev lists (courtesy of Duren).
Columns 1-3 are chr, start and stop. 

```{r, echo=FALSE}
options(width=300)
musdev_list <- data.table::fread("~/Downloads/mouse_development_enhancer_hg19/liver_P0_enhancr_U6.bed")
dplyr::sample_n(musdev_list,5)
```

There are 66 MusDev lists, each corresponding to a tissue at a given stage.

```{r, echo=FALSE}
bed_files <- list.files("~/Downloads/mouse_development_enhancer_hg19/")
bed_names <- gsub("_enhancr_U6.bed","",bed_files)
bed_info <- data.frame(bed_id=(1:length(bed_names)),bed_name=bed_names,stringsAsFactors=FALSE)

dplyr::sample_n(bed_info,5)
```

```{r, echo=FALSE}
res_mat <- readRDS("~/Dropbox/rss/Data/mouse_development_enhancer/out_market/musdev_ashlrt_20180724.rds")
res_df <- as.data.frame(res_mat/log(10), row.names=NULL)
res_df$bed_id <- (1:66)
res_df <- dplyr::inner_join(bed_info, res_df, by="bed_id")
```

## Analysis methods

I run the same quick assessment on these MusDev lists;
analysis details are the same as my [previous analysis](ashlrt_201peca_31trait.html).

## Example

Below are observations of late-onset Alzheimer's disease

- liver: showing strongest signals in all stages except day 15 in embryo and day 0 after birth;
- hindbrain: showing 2nd strongest signals only on even days (12, 14, 16) in embryo;
- neural tube: showing strongest signal on day 15 in embryo (stronger than liver);
- day 12 in embryo: showing strongest signals across all stages (liver, hindbrain, midbrain).

```{r, echo=FALSE}
load2013_df <- res_df[,c("bed_id","bed_name","load2013")]
load2013_df$tissue <- gsub("\\_.*","",load2013_df$bed_name)
load2013_df$stage <- gsub(".*\\_","",load2013_df$bed_name)
load2013_df_wide <- spread(load2013_df[, c("tissue","stage","load2013")], stage, load2013)

knitr::kable(load2013_df_wide)
```

```{r, fig.height=5, fig.width=7, echo=FALSE}
ggline(load2013_df, x="stage", y="load2013", color="tissue", palette="Paired", xlab="Development stage", ylab="Log 10 likelihood ratio", title="Late-onset Alzheimer's disease", size=1.1)
```

## Full results

```{r, echo=FALSE, results="asis", eval=TRUE}
trait_set <- colnames(res_mat)
num_trait <- length(trait_set)
#num_trait <- 2 # for testing

for (j in 1:num_trait) {
  cat(paste0('### Complex trait: ',trait_set[j],'\n')) 
  tmp_df <- res_df[, c("bed_name","bed_id",trait_set[j])]
  tmp_df <- tmp_df[order(tmp_df[[trait_set[j]]], decreasing=TRUE),]
  rownames(tmp_df) <- NULL
  print(knitr::kable(tmp_df))
  cat('\r\n\r\n')
}
```

